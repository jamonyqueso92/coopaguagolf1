<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reclamos - CoopaguaGolf</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <!-- Header común -->
    <header>
        <h1>CoopaguaGolf - Dashboard</h1>
        <nav>
            <button onclick="navigateTab('dashboard.html')">Facturas</button>
            <button onclick="navigateTab('reclamos.html')">Reclamos</button>
            <button onclick="navigateTab('perfil.html')">Perfil</button>
            <button onclick="logout()">Salir</button>
        </nav>
    </header>

    <main class="container my-4">
        <div class="row">
            <div class="col-md-8">
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h3 class="card-title m-0">Crear Nuevo Reclamo</h3>
                    </div>
                    <div class="card-body">
                        <form id="reclamoForm" enctype="multipart/form-data">
                            <div class="mb-3">
                                <label for="tipoReclamo" class="form-label">Tipo de Reclamo</label>
                                <select class="form-select" id="tipoReclamo" required>
                                    <option value="">Seleccione una opción</option>
                                    <option value="falta_agua">Falta de Agua</option>
                                    <option value="baja_presion">Baja Presión</option>
                                    <option value="perdida">Pérdida en la Vía Pública</option>
                                    <option value="facturacion">Problemas de Facturación</option>
                                    <option value="medidor">Problemas con el Medidor</option>
                                    <option value="otro">Otro</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="urgencia" class="form-label">Nivel de Urgencia</label>
                                <select class="form-select" id="urgencia" required>
                                    <option value="baja">Baja - Puede esperar</option>
                                    <option value="media">Media - Necesita atención esta semana</option>
                                    <option value="alta">Alta - Necesita atención en 24-48hs</option>
                                    <option value="urgente">Urgente - Necesita atención inmediata</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="descripcion" class="form-label">Descripción del Problema</label>
                                <textarea class="form-control" id="descripcion" rows="4" required placeholder="Describa su problema con el mayor detalle posible..."></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="direccion" class="form-label">Dirección Exacta</label>
                                <input type="text" class="form-control" id="direccion" required placeholder="Calle, número, referencias...">
                            </div>
                            <div class="mb-3">
                                <label for="fotoReclamo" class="form-label">Adjuntar Foto (Opcional)</label>
                                <input type="file" class="form-control" id="fotoReclamo" accept="image/*">
                                <div class="form-text">Puede adjuntar una imagen para ayudar a identificar el problema.</div>
                            </div>
                            <button type="submit" class="btn btn-primary">Enviar Reclamo</button>
                        </form>
                        <div id="mensajeEnviado" class="alert alert-success mt-3 d-none">¡Reclamo enviado! Nos contactaremos a la brevedad.</div>
                        <div id="mensajeError" class="alert alert-danger mt-3 d-none">Error al enviar el reclamo. Intente nuevamente.</div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h3 class="card-title m-0">Contacto Urgente</h3>
                    </div>
                    <div class="card-body">
                        <p>Para situaciones urgentes, comuníquese por WhatsApp:</p>
                        <div class="d-grid gap-2">
                            <a href="https://wa.me/549123456789" class="btn btn-success" target="_blank">
                                <i class="bi bi-whatsapp"></i> WhatsApp Urgente
                            </a>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h3 class="card-title m-0">Mis Reclamos Recientes</h3>
                    </div>
                    <div class="card-body p-0">
                        <ul class="list-group list-group-flush" id="misReclamos">
                            <li class="list-group-item text-center">Funcionalidad disponible pronto</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-light text-center py-3 mt-auto">
        <p>&copy; 2024 Cooperativa de Provisión de Servicios y Agua Potable del Barrio Parque Golf</p>
    </footer>

    <script>
        // Simulación de sesión activa
        function isLoggedIn() {
            // Aquí deberías verificar la sesión real (por ejemplo, usando una cookie o localStorage)
            return localStorage.getItem('usuarioActivo');
        }

        function logout() {
            localStorage.removeItem('usuarioActivo');
            window.location.href = '/login.html'; // Redirige al login
        }

        function navigateTab(url) {
            window.location.href = url;
        }

        // Al cargar, verifica sesión
        window.onload = function() {
            if (!isLoggedIn()) {
                window.location.href = '/login.html';
            }
        };

        // Enviar formulario por mail usando mailto (puedes mejorar esto con backend más adelante)
        document.getElementById('reclamoForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const tipoReclamo = document.getElementById('tipoReclamo').value;
            const urgencia = document.getElementById('urgencia').value;
            const descripcion = document.getElementById('descripcion').value;
            const direccion = document.getElementById('direccion').value;
            const fotoInput = document.getElementById('fotoReclamo');

            let tipoTexto = '';
            switch(tipoReclamo) {
                case 'falta_agua': tipoTexto = 'Falta de Agua'; break;
                case 'baja_presion': tipoTexto = 'Baja Presión'; break;
                case 'perdida': tipoTexto = 'Pérdida en la Vía Pública'; break;
                case 'facturacion': tipoTexto = 'Problemas de Facturación'; break;
                case 'medidor': tipoTexto = 'Problemas con el Medidor'; break;
                case 'otro': tipoTexto = 'Otro'; break;
            }

            const asunto = `RECLAMO - ${tipoTexto}`;
            let cuerpo = `Tipo de Reclamo: ${tipoTexto}\nNivel de Urgencia: ${urgencia}\nDirección: ${direccion}\nDescripción: ${descripcion}\n`;

            // Si hay imagen, se recomienda adjuntarla manualmente
            if (fotoInput.files.length > 0) {
                cuerpo += '\n(Adjuntar imagen desde el correo)';
            }

            // mailto: no permite adjuntos, pero puedes abrir el correo al usuario para que lo complete
            const mailtoLink = `mailto:coopaguagol@gmail.com?subject=${encodeURIComponent(asunto)}&body=${encodeURIComponent(cuerpo)}`;

            window.location.href = mailtoLink;

            document.getElementById('mensajeEnviado').classList.remove('d-none');
            setTimeout(() => {
                document.getElementById('mensajeEnviado').classList.add('d-none');
            }, 6000);
        });
    </script>
</body>
</html>
